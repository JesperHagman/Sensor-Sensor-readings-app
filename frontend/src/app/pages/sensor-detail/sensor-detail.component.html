<section class="section stack-l">
  <a routerLink="/sensors" class="muted">← Tillbaka</a>

  <div class="card stack-m">
    <div class="card-header">
      <h1 *ngIf="sensor">
        {{ sensor.name }} <small class="muted">({{ sensor.model }})</small>
      </h1>
      <span class="chip" *ngIf="sensor?.description">{{ sensor?.description }}</span>
    </div>

    <!-- Filters -->
    <form [formGroup]="form" (ngSubmit)="applyFilter()" class="toolbar">
      <div class="field">
        <label>Start</label>
        <input type="datetime-local" class="input" formControlName="start" />
      </div>

      <div class="field">
        <label>Slut</label>
        <input type="datetime-local" class="input" formControlName="end" />
      </div>

      <button type="submit" class="btn btn-outline">Filtrera</button>
    </form>

    <div class="state" *ngIf="loading">Laddar…</div>
    <div class="error" *ngIf="error">{{ error }}</div>

    <!-- Chart -->
    <div class="card" style="padding: 0;">
      <div style="height: 360px; padding: var(--sp-5);">
        <canvas #lineChart></canvas>
      </div>
    </div>

    <!-- Pager -->
    <div class="pager" *ngIf="pageData">
      <button class="btn btn-ghost" (click)="prevPage()" [disabled]="page===1">Föregående</button>
      <span class="muted">
        Sida {{ page }} / {{ totalPages }} — totalt {{ pageData.count }} rader
      </span>
      <button class="btn btn-ghost" (click)="nextPage()" [disabled]="page*pageSize >= pageData.count">Nästa</button>
    </div>

    <!-- Latest 20 (from current page) -->
    <div class="card">
      <div class="card-header">
        <h2>Senaste 20 på sidan</h2>
      </div>

      <div class="table-wrap" *ngIf="latest20.length">
        <table>
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>Temp (°C)</th>
              <th>Humidity (%)</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of latest20">
              <td>{{ r.timestamp | date:'yyyy-MM-dd HH:mm:ss' }}</td>
              <td>{{ r.temperature }}</td>
              <td>{{ r.humidity }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <hr class="light" />

    <!-- Add reading -->
    <div class="card">
      <div class="card-header">
        <h2>Lägg till avläsning</h2>
      </div>
      <form [formGroup]="addForm" (ngSubmit)="addReading()" class="stack-s" style="max-width: 520px;">
        <input type="number" step="0.01" class="input" formControlName="temperature" placeholder="Temperature °C" />
        <input type="number" step="0.01" class="input" formControlName="humidity" placeholder="Humidity %" />
        <input type="datetime-local" class="input" formControlName="timestamp" />
        <button type="submit" class="btn">Lägg till</button>
      </form>
    </div>
  </div>
</section>
